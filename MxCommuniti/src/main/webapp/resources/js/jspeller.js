JSpeller=util.Class({row:null,column:null,parent:null,box:null,imgUrl:null,width:null,height:null,cellCount:null,cellWidth:null,cellHeight:null,level:null,finishEvent:null,initialize:function(c,a){this.parent=document.getElementById(c);this.row=this.optionValue(a,a.row,3);this.column=this.optionValue(a,a.column,5);this.imgUrl=this.optionValue(a,a.imgUrl,"");this.width=this.optionValue(a,a.width,300);this.height=this.optionValue(a,a.height,200);this.level=this.optionValue(a,a.level,2);var b="speller_box_"+(new Date()).getTime();this.parent.innerHTML='<div id="'+b+'" style="position: relative; width: '+(this.width-1)+"px; height: "+(this.height-1)+'px;" ></div>';this.box=document.getElementById(b);this.createGrid();this.start()},X:function(a){return a%this.column*this.cellWidth},Y:function(a){return parseInt(a/this.column)*this.cellHeight},createGrid:function(){this.cellCount=this.column*this.row;this.cellWidth=parseInt(this.width/this.column);this.cellHeight=parseInt(this.height/this.row);for(var b=0,a=[];b<this.cellCount;b++){a.push('<p id="'+b+'" class="'+b+'"  style="background-color: black;position: absolute; margin: 0px; padding: 0px; left:'+this.X(b)+"px;top:"+this.Y(b)+"px;  width: "+(this.cellWidth-1)+"px; height: "+(this.cellHeight-1)+"px; background-image: url("+this.imgUrl+"); background-position:-"+this.X(b)+"px -"+this.Y(b)+'px;"></p>')}this.box.innerHTML=a.join("");var d=this.box.getElementsByTagName("p");var c=this;for(var b=0;b<d.length;b++){d[b].onclick=function(e){c.move(e.target)}}},stop:function(){var a=this.box.getElementsByTagName("p");a[this.blank].style.display="block";this.blank=null},check:function(){var c=this.box.getElementsByTagName("p");for(var b=0,a=c.length;b<a;b++){if(c[b].className!=c[b].id){return false}}if(this.finishEvent!=null){this.finishEvent()}return true},move:function(c){if(this.blank!=null&&this.blank>=0&&this.blank<this.cellCount){var d=this;var e=c.className*1,b=this.blank*1,a=Math.abs(e-b);if(a==this.column){this.powerAnimate(this.Y(e),this.Y(b),function(f){c.style.top=f+"px"},function(){d.check()},240,0.4)}else{if(a==1){this.powerAnimate(this.X(e),this.X(b),function(f){c.style.left=f+"px"},function(){d.check()},240,0.4)}else{return}}c.className=b;this.blank=e}},move2:function(b){var c=b.className*1;var a=this.blank*1;b.style.top=this.Y(a)+"px";b.style.left=this.X(a)+"px";b.className=a;this.blank=c},randomCell:function(b){var a=[];if(b>=0&&b<this.cellCount){if((b%this.column)!=(this.column-1)){a.push(b+1)}if((b%this.column)!=0){a.push(b-1)}if(b>(this.column-1)){a.push(b-this.column)}if(b<(this.cellCount-this.column)){a.push(b+this.column)}}return a[parseInt(Math.random()*a.length)]*1},start:function(){this.blank=this.cellCount-1;var d=this.box.getElementsByTagName("p");var b=d.length;d[this.blank].style.display="none";var a=function(f){for(var e=0;e<b;e++){if(d[e].className==f){return d[e]}}};for(var c=0;c<this.level;c++){this.move2(a(this.randomCell(this.blank*1)))}},optionValue:function(b,a,c){return b&&a?a:c},powerAnimate:function(h,c,e,b,g,f){var a=null;var d=new Date();var g=g||240;var f=f||2;a=setInterval(function(){var j=new Date();var i=j.getTime()-d.getTime();var k=Math.min(1,i/g);e(h+(c-h)*Math.pow(k,f));if(k==1){if(b!=null){b()}clearInterval(a)}},10)}});