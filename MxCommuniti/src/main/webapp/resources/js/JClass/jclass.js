window.JClass={};JClass.Class=function(){var a=arguments[0];var b=typeof a.initialize=="function"?a.initialize:null;if(b!=null){b.prototype=a}return b};JClass.Pixel=JClass.Class({x:0,y:0,initialize:function(a,b){this.x=parseInt(a);this.y=parseFloat(b)},clone:function(){return new JClass.Pixel(this.x,this.y)},CLASS_NAME:"JClass.Pixel"});JClass.Student=JClass.Class({name:null,sex:null,code:null,lastVisit:null,initialize:function(b,d,c,a){this.name=b;this.sex=d;this.code=c;if(a!=null){this.lastVisit=new Date(a)}},CLASS_NAME:"JClass.Student"});JClass.Util={};JClass.Util.modifyDOMElement=function(c,b,a){if(b){c.style.left=b.x+"px";c.style.top=b.y+"px"}if(a){c.style.position=a}};JClass.Util.removeItem=function(c,b){for(var a=c.length-1;a>=0;a--){if(c[a]==b){c.splice(a,1)}}return c};JClass.Desk=JClass.Class({id:null,div:null,px:null,student:null,online:null,draggable:false,titleVisible:true,htmlContent:null,initialize:function(d,a,b){this.div=document.createElement("div");if(b!=null){$(this.div).addClass("jclass-desk-2")}else{$(this.div).addClass("jclass-desk-1")}$(this.div).append("<span class='jclass-desk-title'></span>");$(this.div).append("<div class='jclass-desk-user' style='display: none;'></div>");$(this.div).append("<div class='jclass-desk-htmlcontent' style='display: none;'></div>");var c=this;$(this.div).draggable({grid:[5,5],containment:"parent",disabled:true,stop:function(e,f){c.px.x=f.position.left;c.px.y=f.position.top;c.draw(c.px)}});this.id=d;this.px=a;this.student=b},setStudent:function(a){this.student=a;this.draw()},setOnline:function(a){this.online=a;this.draw()},display:function(a){this.div.style.display=(a)?"":"none"},draw:function(b){JClass.Util.modifyDOMElement(this.div,null,"absolute");this.online=false;if(this.student!=null){$(this.div).addClass("jclass-desk-2");$(this.div).find(".jclass-desk-title").html(this.student.name);if(this.titleVisible){$(this.div).find(".jclass-desk-title").show()}else{$(this.div).find(".jclass-desk-title").hide()}var a=new Date();if(this.student.lastVisit!=null&&(a.getTime()-this.student.lastVisit.getTime()<3600000)){this.online=true}if(this.student.sex==1){$(this.div).find(".jclass-desk-user").addClass("jclass-desk-boy")}else{$(this.div).find(".jclass-desk-user").addClass("jclass-desk-girl")}}else{$(this.div).addClass("jclass-desk-1");$(this.div).find(".jclass-desk-title").hide()}if(this.online&&!this.draggable){$(this.div).find(".jclass-desk-user").show()}else{$(this.div).find(".jclass-desk-user").hide()}$(this.div).draggable("option","disabled",!this.draggable);this.moveTo(b);this.div},moveTo:function(a){if(a!=null){this.px=a}if(this.div!=null){if(this.px==null){this.display(false)}else{JClass.Util.modifyDOMElement(this.div,this.px,null)}}},setDraggable:function(a){this.draggable=a;this.draw()},showTitle:function(a){this.titleVisible=a;this.draw()},erase:function(){if(this.div!=null&&this.div.parentNode!=null){this.div.parentNode.removeChild(this.div)}},setHtmlContent:function(a){this.htmlContent=a;$(this.div).find(".jclass-desk-htmlcontent").html("");if(this.htmlContent==null||this.htmlContent==""){$(this.div).find(".jclass-desk-htmlcontent").hide()}else{$(this.div).find(".jclass-desk-htmlcontent").html(this.htmlContent);$(this.div).find(".jclass-desk-htmlcontent").show()}return $(this.div).find(".jclass-desk-htmlcontent").first()},CLASS_NAME:"JClass.Desk"});JClass.ClassRoom=JClass.Class({div:null,draggable:false,selectable:false,deletable:false,viewPortDiv:null,desks:null,className:"班级名称",selectEventCallback:null,deleteEventCallback:null,initialize:function(b){var a=document.getElementById(b);this.div=document.createElement("div");a.appendChild(this.div);$(this.div).addClass("jclass-classroom-div");this.viewPortDiv=document.createElement("div");$(this.viewPortDiv).addClass("jclass-classroom-facade");this.div.appendChild(this.viewPortDiv);$(this.viewPortDiv).append("<div class='jclass-classroom-name'><span>班级名称<span></div>");$(this.viewPortDiv).droppable({drop:function(c,d){}});this.desks=[]},addDesk:function(a){this.desks.push(a);this.viewPortDiv.appendChild(a.div);a.setDraggable(this.draggable);this.drawDesk(a)},drawDesk:function(b){b.draw();if((b.student==null)&&(this.selectable||this.deletable)){if(this.selectable){var a=b.setHtmlContent("<div class='jclass-classroom-control'><a><span><em>+</em>选座</span></a></div>");var c=this;a.find("a").click(function(){if(c.selectEventCallback!=null){c.selectEventCallback(b)}})}else{var a=b.setHtmlContent("<div class='jclass-classroom-delete'><a></a></div>");var c=this;a.find("a").click(function(){if(c.deleteEventCallback!=null){c.deleteEventCallback(b)}})}}else{b.setHtmlContent(null)}},getDesks:function(){return this.desks},enableDraggable:function(a){this.draggable=a;for(var b=0;b<this.desks.length;b++){this.desks[b].setDraggable(a)}},enableSelectable:function(a){this.selectable=a;for(var b=0;b<this.desks.length;b++){if(this.desks[b].student==null){this.drawDesk(this.desks[b])}}},enableDeletable:function(b){this.deletable=b;for(var a=0;a<this.desks.length;a++){if(this.desks[a].student==null){this.drawDesk(this.desks[a])}}},showDeskTitle:function(a){for(var b=0;b<this.desks.length;b++){this.desks[b].showTitle(a)}},setClassName:function(a){this.className=a;$(this.viewPortDiv).find(".jclass-classroom-name span").text(this.className)},removeDesk:function(a){if(this.desks&&this.desks.length){JClass.Util.removeItem(this.desks,a);a.erase()}},clearDesks:function(){if(this.desks!=null){while(this.desks.length>0){this.removeDesk(this.desks[0])}}},CLASS_NAME:"JClass.ClassRoom"});